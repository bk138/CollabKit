#!/usr/bin/make -f
VERSION := $(shell dpkg-parsechangelog | grep ^Version | cut -d' ' -f2-)

build:
binary: binary-indep
binary-arch:
binary-indep:
# first the bins and helper scripts
	install -m 755 -D collabkit debian/tmp/usr/bin/collabkit
	install -m 755 -D bin/x11vnc debian/tmp/usr/lib/collabkit/x11vnc
	install -m 755 -D bin/vncviewer debian/tmp/usr/lib/collabkit/vncviewer
	install -m 755 -D bin/gromit-mpx debian/tmp/usr/lib/collabkit/gromit-mpx
	install -m 755 -D bin/xi2setcursor debian/tmp/usr/lib/collabkit/xi2setcursor
	install -m 755 -D bin/setcursor_helper debian/tmp/usr/lib/collabkit/setcursor_helper
# icons
	install -m 644 -D res/collabkit-started.svg debian/tmp/usr/share/icons/collabkit-started.svg
	install -m 644 -D res/collabkit-stopped.svg debian/tmp/usr/share/icons/collabkit-stopped.svg
# desktop file
	install -m 644 -D debian/CollabKit.desktop debian/tmp/usr/share/applications/CollabKit.desktop
# now the docs
	install -m 644 -D debian/copyright debian/tmp/usr/share/doc/collabkit/copyright
	install -m 644 -D README debian/tmp/usr/share/doc/collabkit/README
	gzip -c9 debian/changelog > debian/tmp/usr/share/doc/collabkit/changelog.Debian.gz
	if [ ! -d debian/tmp/DEBIAN ] ; then mkdir debian/tmp/DEBIAN; fi
	dpkg-gencontrol
	cd debian/tmp && find usr/ -type f -print0 | xargs -r0 md5sum >DEBIAN/md5sums
	dpkg-deb -b debian/tmp ../collabkit_$(VERSION)_i386.deb
clean:
	if [ -d debian/tmp ]; then rm -r debian/tmp; fi
	if [ -f debian/files ]; then rm debian/files; fi
