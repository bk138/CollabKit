#!/bin/sh


# this creates an open (!) adhoc WLAN 
# we have to do it this way cause network-manager seems not to work...


SSID="collabnet"



CMDLN_ARGS="$@" # Command line arguments for this script
export CMDLN_ARGS

# Run this script as root if not already.
chk_root () {

  if [ ! $( id -u ) -eq 0 ]; then
    echo "Please enter admin password."
    exec sudo sh -c "${0} ${CMDLN_ARGS}" # Call this prog as root
    exit ${?}  # sice we're 'execing' above, we wont reach this exit
               # unless something goes wrong.
  fi

}

# Call this function early on - now or before your script's main loop starts.
chk_root

IF="$2"
if [ "$IF" = "" ]
then
   echo "Usage: $0 {start|stop} [interface]" >&2
   exit 1
fi

 

case "$1" in
  start)
    /etc/init.d/NetworkManager stop
    ifconfig $IF down
    iwconfig $IF mode ad-hoc
    iwconfig $IF channel 4
    iwconfig $IF essid $SSID
    iwconfig $IF key off
    ifconfig $IF up
    dhclient $IF
    ;;
  stop)
    /etc/init.d/NetworkManager start
    ;;
    *)
    echo "Usage: $0 {start|stop} [interface]" >&2
    exit 1
    ;;
esac